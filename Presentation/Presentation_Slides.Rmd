---
title: "Presentation Slides Code"
output: html_document
date: "2024-10-28"
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidymodels)
library(tidyverse)
library(data.table)
library(here)
library(ggcorrplot)
```

# Introduction

This document serve as a back-end document of the presentation slides that was created using Canva. The presentation itself is located in the same folder with file named "...". Through this document, all figures (plots and table) that was created using **R** will be included and the code that used to generate these figures will be shown. For additional information, all codes that are present in this document can be found on the original documents where they were used to generate plots, figures, and tables, this is where they all collected together to create the slides. Therefore, to understand the code, please also refer to the original document, which the details will be provided on each code.

# Slide Details

Before creating all figures, the code below will call the cleaned data that has gone through data preparation process. The detail of the data preparation process can be found in file **"01_Data_Preparation.Rmd"**.
```{r}
alldata_pres <- readRDS(here('results/all_data.rds'))
```

## Slide 6
In this slide, the descriptive statistics table was created using the code below. Additionally, this can be found in the **"02_Exploratory_Data_Analysis.Rmd"** specifically in the **"Descriptive Statistics"** section.
```{r descstats, message = FALSE, warning = FALSE, error = FALSE}
# Populate descriptive stats table
desc_stats_flt_pres <- alldata_pres %>%
  group_by(Element_Symbol, Element_Description) %>%
  summarise(min = min(Element_Value_ppm),
         max = max(Element_Value_ppm),
         mean = mean(Element_Value_ppm),
         median = median(Element_Value_ppm),
         range = max(Element_Value_ppm) - min(Element_Value_ppm),
         q1 = quantile(Element_Value_ppm, 0.25),
         q3 = quantile(Element_Value_ppm, 0.75),
         iqr = IQR(Element_Value_ppm),
         sd = sd(Element_Value_ppm),
         var = var(Element_Value_ppm),
         skewness = moments::skewness(Element_Value_ppm),
         kurtosis = moments::kurtosis(Element_Value_ppm)) %>%
  filter(Element_Symbol %in% c("REE", "HREE", "LREE", "Ag", "Cd", "Co", "Cu", "Li", "Mo", "Ni", "Pb", "Sc", "Tl", "Zn")) %>%
  select(Element_Symbol, min, max, mean, median, sd, kurtosis)

print(desc_stats_flt_pres)
```


## Slide 7
This correlation matrix plot can be found in the **"02_Exploratory_Data_Analysis.Rmd"** specifically in the **"Correlation Matrix plot"** section. The code used to generate this plot is:
```{r}
res_cor_cop_pres <- alldata_pres %>% 
  select(Project_Name,Sample_ID,Element_Symbol,PAAS_normalised_value) %>% 
  pivot_wider(names_from = Element_Symbol,values_from = c(PAAS_normalised_value))


corr_cop_cheaper_pres <- cor(res_cor_cop_pres[,c("Ag", "Cd", "Co", "Cu", "Li", "Mo", "Ni", "Pb", "Sc", "Tl", "Zn", "REE", "HREE", "LREE")],
                        use="pairwise.complete.obs")

# corr_cop_cheaper <- data.frame(corr_cop[c("REE", "HREE", "LREE"), c("Ag", "Cd", "Co", "Cu", "Li", "Mo", "Ni", "Pb", "Sc", "Tl", "Zn")])

pg_cop_cheaper_pres <- ggcorrplot(corr_cop_cheaper_pres, 
                     method = "square", 
                     type = "lower",
                     outline.col = "white", 
                     lab = TRUE, 
                     lab_size = 3)

print(pg_cop_cheaper_pres)
```


## Slide 9 - Predictive Modelling...(4)
The result table was generated through a long modelling process which can be found in the **"03_Predictive_Analysis.Rmd"** file. The result table is generated by calling the object that has been saved in the file mentioned earlier to make this document tidy. Please refer to that document for more detailed information. The table below shows predictive model for predicting REE.
```{r}
results_ree_test_pres <- readRDS(here('Final_report/Final_report_files/results_ree_test_df.rds'))

print(results_ree_test_pres)
```


## Slide 10 - Predictive Modelling...(5)
The result table was generated through a long modelling process which can be found in the **"03_Predictive_Analysis.Rmd"** file. The result table is generated by calling the object that has been saved in the file mentioned earlier to make this document tidy. Please refer to that document for more detailed information. The table below shows predictive model for predicting HREE.
```{r}
# Load hree test result
results_hree_test_pres <- readRDS(here('Final_report/Final_report_files/results_hree_test_df.rds'))

print(results_hree_test_pres)
```


## Slide 11 - Predictive Modelling...(6)
The result table was generated through a long modelling process which can be found in the **"03_Predictive_Analysis.Rmd"** file. The result table is generated by calling the object that has been saved in the file mentioned earlier to make this document tidy. Please refer to that document for more detailed information. The table below shows predictive model for predicting LREE.
```{r}
# Load lree test result
results_lree_test_pres <- readRDS(here('Final_report/Final_report_files/results_lree_test_df.rds'))

print(results_lree_test_pres)
```


## Slide 12
Similar to the last few slides, all these plots are the continuation of the process after the modelling part. All these codes were used in the **"03_Predictive_Analysis.Rmd"** file as well. Therefore, please refer to that document for a more detailed information.

### REE Plot
```{r prediction_results, fig.cap = "Actual vs Prediction Results", fig.width = 8, fig.height = 8, fig.align = "center", warning = FALSE, error = FALSE}

# Plot for REE
ree_rmse_value_pres <- results_ree_test_pres[2,5]
ree_rsq_value_pres <- results_ree_test_pres[2,8]
ree_mae_value_pres <- results_ree_test_pres[2,6]
ree_mape_value_pres <- results_ree_test_pres[2,7]

# Load ree test result
ree_results_test <- readRDS(here('Final_report/Final_report_files/ree_results_test.rds'))

# Creating the plot
ree_results_test %>%
  filter(model %in% c("RF_Rdm_Tuned_3")) %>%
  ggplot(aes(.pred, truth)) +
  geom_abline(lty = 2, linewidth = 0.75, linetype = "dashed", colour='red') +
  geom_point(alpha = 0.7, colour = "black", size = 5) +
  xlim(c(0,400)) +
  ylim(c(0,400)) +
  xlab("Predicted") +
  ylab("Actual") +
  theme_minimal() +
  theme(axis.title.x = element_text(size = 24),            # Increase X-axis title size
        axis.title.y = element_text(size = 24)) +          # Increase Y-axis title size
  # Annotate the plot with the metrics
  annotate("text", x = 390, y = 76, label = paste("RMSE: ", round(ree_rmse_value_pres, 2)), size = 9, hjust = 1) +
  annotate("text", x = 390, y = 51, label = paste("MAE: ", round(ree_mae_value_pres, 2)), size = 9, hjust = 1) +
  annotate("text", x = 390, y = 26, label = paste("MAPE: ", round(ree_mape_value_pres, 2)), size = 9, hjust = 1) +
  annotate("text", x = 390, y = 1, label = paste("R-squared: ", round(ree_rsq_value_pres, 2)), size = 9, hjust = 1)
```

### HREE Plot
```{r hree_pred_res, fig.cap = "Actual vs Prediction Results", fig.width = 8, fig.height = 8, fig.align = "center", warning = FALSE, error = FALSE}

# Getting metrics values
hree_rmse_value_pres <- results_hree_test_pres[1,5]
hree_rsq_value_pres <- results_hree_test_pres[1,8]
hree_mae_value_pres <- results_hree_test_pres[1,6]
hree_mape_value_pres <- results_hree_test_pres[1,7]

# Load hree test result
hree_results_test <- readRDS(here('Final_report/Final_report_files/hree_results_test.rds'))

hree_results_test %>%
  filter(model %in% c("RF_Rdm_Tuned_HREE")) %>%
  ggplot(aes(.pred, truth)) +
  geom_abline(lty = 2, linewidth = 0.75, linetype = "dashed", colour='red') +
  geom_point(alpha = 0.7, colour = "black", size = 5) +
  xlim(c(0,35)) +
  ylim(c(0,35)) +
  xlab("Predicted") +
  ylab("Actual") +
  # facet_wrap(~train) +
  theme_minimal() +
  theme(axis.title.x = element_text(size = 24),            # Increase X-axis title size
        axis.title.y = element_text(size = 24)) +          # Increase Y-axis title size
  # Annotate the plot with the metrics
  annotate("text", x = 32, y = 7, label = paste("RMSE: ", round(hree_rmse_value_pres, 2)), size = 9, hjust = 1) +
  annotate("text", x = 32, y = 5, label = paste("MAE: ", round(hree_mae_value_pres, 2)), size = 9, hjust = 1) +
  annotate("text", x = 32, y = 3, label = paste("MAPE: ", round(hree_mape_value_pres, 2)), size = 9, hjust = 1) +
  annotate("text", x = 32, y = 1, label = paste("R-squared: ", round(hree_rsq_value_pres, 2)), size = 9, hjust = 1)
```


### LREE Plot
```{r lree_pred_res, fig.cap = "Actual vs Prediction Results", fig.width = 8, fig.height = 8, fig.align = "center", warning = FALSE, error = FALSE}

# Getting metrics values
lree_rmse_value_pres <- results_lree_test_pres[3,5]
lree_rsq_value_pres <- results_lree_test_pres[3,8]
lree_mae_value_pres <- results_lree_test_pres[3,6]
lree_mape_value_pres <- results_lree_test_pres[3,7]

# Load lree test result
lree_results_test <- readRDS(here('Final_report/Final_report_files/lree_results_test.rds'))

# Generate the plt
lree_results_test %>%
  filter(model %in% c("RF_Rdm_Tuned_LREE_4")) %>%
  ggplot(aes(.pred, truth)) +
  geom_abline(lty = 2, linewidth = 0.75, linetype = "dashed", colour='red') +
  geom_point(alpha = 0.7, colour = "black", size = 5) +
  xlim(c(0,300)) +
  ylim(c(0,300)) +
  xlab("Predicted") +
  ylab("Actual") +
  theme_minimal() +
  theme(axis.title.x = element_text(size = 24),            # Increase X-axis title size
        axis.title.y = element_text(size = 24)) +          # Increase Y-axis title size
  # Annotate the plot with the metrics
  annotate("text", x = 290, y = 61, label = paste("RMSE: ", round(lree_rmse_value_pres, 2)), size = 9, hjust = 1) +
  annotate("text", x = 290, y = 41, label = paste("MAE: ", round(lree_mae_value_pres, 2)), size = 9, hjust = 1) +
  annotate("text", x = 290, y = 21, label = paste("MAPE: ", round(lree_mape_value_pres, 2)), size = 9, hjust = 1) +
  annotate("text", x = 290, y = 1, label = paste("R-squared: ", round(lree_rsq_value_pres, 2)), size = 9, hjust = 1)

```