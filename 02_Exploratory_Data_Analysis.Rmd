---
title: "02_Exploratory_Data_Analysis"
output: html_document
date: '`r Sys.Date()`'
---

```{r library, echo = FALSE, include = FALSE}

library(dplyr)
library(ggplot2)
library(knitr)
library(kableExtra)
library(corrplot)
library(ggcorrplot) 
library(gridExtra)
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
theme_set(theme_minimal())
```

# Exploratory Data Analysis (EDA)

This document presents an EDA of elements' concentration data (named as `all_data.rds`), which provide information about the concentration of critical mineral across different areas in Australia that has been normalised using PAAS (Post-Archean Australian Shale) standard. The primary objective of this analysis is to gain a deeper understanding of the data's structure and key characteristics, which will inform subsequent modeling and decision-making processes. Through this analysis, we aim to identify significant trends, correlations, and outliers that may influence the outcomes of the study.

## Load the Data
```{r}
# Loading all data
alldata <- readRDS('./results/all_data.rds')

str(alldata)
```
Our data comprises of **`r nrows(alldata)` observations** and **`r ncols(alldata)` variables**. Most of the variables are character type, except for variable `Element_Value_ppm`, `PAAS_value_ppm`, and `PAAS_normalised_value` that are numeric type. The \ref{tab:preview} provide a preview of the data from top of 10 observations.

```{r preview, fig.cap = "Top 10 observations of the data.", out.width = "100%", fig.align = "center"}
kable(head(alldata, n = 10))
```


## Descriptive Statistics

This section provides some generic statistics information about the data, such as min, max, mean, median, and others. The table \ref{tab:desc_stats} lay out the details about these informations for each element.
```{r desc_stats, fig.cap = "Descriptive Statistics of Elements' Concentration", out.width = "100%", fig.align = "center"}
# Exclude -999.00 data
alldata <- alldata[alldata$Element_Value_ppm != -999.00, ]

# Populate descriptive stats table
desc_stats <- alldata %>%
  group_by(Element_Symbol, Element_Description) %>%
  summarise(min = min(Element_Value_ppm),
         max = max(Element_Value_ppm),
         mean = mean(Element_Value_ppm),
         median = median(Element_Value_ppm),
         range = max(Element_Value_ppm) - min(Element_Value_ppm),
         q1 = quantile(Element_Value_ppm, 0.25),
         q3 = quantile(Element_Value_ppm, 0.75),
         iqr = IQR(Element_Value_ppm),
         sd = sd(Element_Value_ppm),
         var = var(Element_Value_ppm))

kable(desc_stats)
```


## Distribution of elements with reference to PASS levels

In this analysis, we are trying to assess all critical elements towards the PAAS standard. To begin with, we start from a high-level distribution across the two main categories that we used to identify which elements that are above and below standard. The normalised value will be flagged as "Enriched above background" if it is above 1, while the rest will be flagged as "Below background". The figure \ref{fig:fig_overall} provide the details about this high-level distribution.

```{r fig_overall, fig.cap = "The Profile of PASS Categories", out.width = "100%", fig.align = "center"}
alldata %>%
  group_by(Above_PASS_flag) %>%
  summarise(count = n()) %>%
  ungroup() %>%  # Ungroup to perform operations on the entire data frame
  mutate(Above_PASS_flag = reorder(Above_PASS_flag, -count, sum)) %>%  # Reorder based on the sum of counts
  ggplot(aes(x = Above_PASS_flag, y = count, fill = Above_PASS_flag)) +
  geom_text(aes(label = count), size = 3, vjust = -0.5, color = "black", position = position_dodge(0.9)) +
  geom_col(position = "dodge") +
  scale_fill_brewer(palette = "Set1")
```
As depicted in the bar chart, the distribution appears fairly balanced between the two categories, with 5,724 instances classified as "Enriched Above Background" and 5,355 instances falling "Below Background". Such a balance highlights the importance of further detailed analysis to understand the factors contributing to this distribution, the significance of enrichment in the context of the dataset, and how these elements behave under different conditions.

Moving on to the element's level, we will assess how each element's concentration level compares to the PAAS standard. For each elements below, the value shown is the normalised, meaning we have incorporated the standard value towards the element's original values (based on sample taken). Figure \ref{fig:fig_elementcons} shows the profile of each sample towards this standard and their respective flags. 
```{r fig_elementcons, fig.cap = "Distribution of elements with reference to PASS levels' Concentration", out.width = "100%", fig.align = "center"}
alldata %>%
  ggplot(aes(x = PAAS_normalised_value, y = Element_Symbol, color = Above_PASS_flag)) +
  geom_point() +
  geom_vline(xintercept = 1, linetype = 2) +
  scale_color_brewer(palette = "Set1")
```
As can be seen, the majority of normalised value fall within 0 to 10, while the rest are can be counted as outliers. A highlight point from this plot is all of 'Ag' concentration values are above PAAS standard. This could indicate that coal waste are rich in 'Ag'.

Additionally, we also analyse how the distribution of critical elements across various Project Area. The figure \ref{fig:fig_projectcons} shows how many elements that was recorded in each project area that fall into these two categories.
```{r fig_projectcons, fig.cap = "The Profile of Project Area with reference to PASS levels' Concentration", out.width = "100%", fig.align = "center"}
alldata %>%
  group_by(Project_Name, Above_PASS_flag) %>%
  summarise(count = n()) %>%
  ungroup() %>%  # Ungroup to perform operations on the entire data frame
  mutate(Project_Name = reorder(Project_Name, count, sum)) %>%  # Reorder based on the sum of counts
  ggplot(aes(x = count, y = Project_Name, fill = Above_PASS_flag)) +
  geom_text(aes(label = count), size = 3, vjust = 0.5, hjust = -0.1, color = "black", position = position_dodge(0.9)) +
  geom_col(position = "dodge") +
  #facet_wrap(~ Project_Name) +
  theme(axis.text.x = element_blank()) +
  scale_fill_brewer(palette = "Set1")
```

Some key observations:

- The "Confidential_C" project stands out with a substantial number of elements (3,358) categorised as "Enriched Above Background", significantly outnumbering the "Below Background" category count (1,192). This suggests a considerable concentration of elements that exceed PAAS standard in this project.
- Project such as "Fort Cooper", "Confidential_B" and "Confidential_A" display a more balanced distribution between two categories, indicating a near-equal mix of elements that either meet or fall short of the enrichment criteria.
- In contrast, several projects, such as "Wandoan", "Copabella", "Lake Vermont", "Collinsville", "Moorvalle", "Newlands", "Metropolitan", "Rolleston" exhibit a higher count of elements classified as "Below Background". This implies that these projects have a significant proportion of elements that do not reach the enrichment threshold.
- A few projects, including "Oaky Creek", and "Unnamed", contribute minimally to the overall dataset, with very few elements categorised in either categories.


## Distribution Analysis
```{r}
alldata %>%
  ggplot(aes(x = PAAS_normalised_value, fill = Above_PASS_flag)) +
  geom_density() +
  xlim(-10, 10) +
  scale_fill_brewer(palette = "Set1")
```


```{r}
alldata %>%
  ggplot(aes(x = PAAS_normalised_value, y = Element_Symbol)) +
  geom_boxplot() +
  geom_vline(xintercept = 1, linetype = 2)
```

```{r}
alldata %>%
  ggplot(aes(x = PAAS_normalised_value, y = Element_Symbol, color = Above_PASS_flag)) +
  geom_point() +
  geom_vline(xintercept = 1, linetype = 2) +
  scale_color_brewer(palette = "Set1") +
  facet_wrap(~ Project_Name)
```


## Correlation Matrix plot

```{r}
res_cor_cop <- alldata %>% 
  select(Project_Name,Sample_ID,Element_Symbol,Element_Value_ppm) %>% 
  pivot_wider(names_from = Element_Symbol,values_from = c(Element_Value_ppm))



corr_cop <- cor(res_cor_cop[,3:55])


pg_cop <- ggcorrplot(corr_cop,type = "lower",
     outline.col = "white", lab = TRUE, lab_size = 2)

print(pg_cop)
```

## Scatter Plot

### Correlation of LREE
```{r}
# LREE
res_cor_cop %>%
  ggplot(aes(x = LREE, y = MREE)) +
  geom_point() +
  geom_smooth(method = "lm")
```

### Correlation of Yb
```{r}
# Yb
res_cor_cop %>%
  ggplot(aes(x = Yb, y = Zr)) +
  geom_point() +
  geom_smooth(method = "lm")
```

### Correlation of Tb
```{r}
# Tb
res_cor_cop %>%
  ggplot(aes(x = Tb, y = Yb)) +
  geom_point() +
  geom_smooth(method = "lm")
```

### Correlation of Sm
```{r}
# Sm & Tb
p1 <- res_cor_cop %>%
  ggplot(aes(x = Sm, y = Tb)) +
  geom_point() +
  geom_smooth(method = "lm")

# Sm & Yb
p2 <- res_cor_cop %>%
  ggplot(aes(x = Sm, y = Yb)) +
  geom_point() +
  geom_smooth(method = "lm")
  
grid.arrange(p1, p2, ncol = 2)
```

### Correlation of Pr
```{r}
# Pr & Sm
p3 <- res_cor_cop %>%
  ggplot(aes(x = Pr, y = Sm)) +
  geom_point() +
  geom_smooth(method = "lm")

# Pr & Tb
p4 <- res_cor_cop %>%
  ggplot(aes(x = Pr, y = Tb)) +
  geom_point() +
  geom_smooth(method = "lm")

# Pr & Th
p5 <- res_cor_cop %>%
  ggplot(aes(x = Pr, y = Th)) +
  geom_point() +
  geom_smooth(method = "lm")

# Pr & Yb
p6 <- res_cor_cop %>%
  ggplot(aes(x = Pr, y = Yb)) +
  geom_point() +
  geom_smooth(method = "lm")

# Pr & Zr
p7 <- res_cor_cop %>%
  ggplot(aes(x = Pr, y = Zr)) +
  geom_point() +
  geom_smooth(method = "lm")

# Pr & LREE
p8 <- res_cor_cop %>%
  ggplot(aes(x = Pr, y = LREE)) +
  geom_point() +
  geom_smooth(method = "lm")
  
grid.arrange(p3, p4, p5, p6, p7, p8, ncol = 3)

```

### Correlation of Pb
```{r}
# Pb & Pr
p9 <- res_cor_cop %>%
  ggplot(aes(x = Pb, y = Pr)) +
  geom_point() +
  geom_smooth(method = "lm")

# Pb & Sm
p10 <- res_cor_cop %>%
  ggplot(aes(x = Pb, y = Sm)) +
  geom_point() +
  geom_smooth(method = "lm")

# Pb & Th
p11 <- res_cor_cop %>%
  ggplot(aes(x = Pb, y = Th)) +
  geom_point() +
  geom_smooth(method = "lm")
  
grid.arrange(p9, p10, p11, ncol = 3)
```

### Correlation of Nd
```{r}
# Nd & Pb
p12 <- res_cor_cop %>%
  ggplot(aes(x = Nd, y = Pb)) +
  geom_point() +
  geom_smooth(method = "lm")

# Nd & Pr
p13 <- res_cor_cop %>%
  ggplot(aes(x = Nd, y = Pr)) +
  geom_point() +
  geom_smooth(method = "lm")

# Nd & Sm
p14 <- res_cor_cop %>%
  ggplot(aes(x = Nd, y = Sm)) +
  geom_point() +
  geom_smooth(method = "lm")

# Nd & Tb
p15 <- res_cor_cop %>%
  ggplot(aes(x = Nd, y = Tb)) +
  geom_point() +
  geom_smooth(method = "lm")

# Nd & Th
p16 <- res_cor_cop %>%
  ggplot(aes(x = Nd, y = Th)) +
  geom_point() +
  geom_smooth(method = "lm")

# Nd & Yb
p17 <- res_cor_cop %>%
  ggplot(aes(x = Nd, y = Yb)) +
  geom_point() +
  geom_smooth(method = "lm")

# Nd & Zr
p18 <- res_cor_cop %>%
  ggplot(aes(x = Nd, y = Zr)) +
  geom_point() +
  geom_smooth(method = "lm")

# Nd & LREE
p19 <- res_cor_cop %>%
  ggplot(aes(x = Nd, y = LREE)) +
  geom_point() +
  geom_smooth(method = "lm")
  
grid.arrange(p12, p13, p14, p15, p16, p17, p18, p19, ncol = 4)
```

### Correlation of Ho
```{r}
# Ho & Nd
p20 <- res_cor_cop %>%
  ggplot(aes(x = Ho, y = Nd)) +
  geom_point() +
  geom_smooth(method = "lm")

# Ho & Pr
p21 <- res_cor_cop %>%
  ggplot(aes(x = Ho, y = Pr)) +
  geom_point() +
  geom_smooth(method = "lm")

# Ho & Sm
p22 <- res_cor_cop %>%
  ggplot(aes(x = Ho, y = Sm)) +
  geom_point() +
  geom_smooth(method = "lm")

# Ho & Tb
p23 <- res_cor_cop %>%
  ggplot(aes(x = Ho, y = Tb)) +
  geom_point() +
  geom_smooth(method = "lm")

# Ho & Yb
p24 <- res_cor_cop %>%
  ggplot(aes(x = Ho, y = Yb)) +
  geom_point() +
  geom_smooth(method = "lm")

# Ho & Zr
p25 <- res_cor_cop %>%
  ggplot(aes(x = Ho, y = Zr)) +
  geom_point() +
  geom_smooth(method = "lm")

grid.arrange(p20, p21, p22, p23, p24, p25, ncol = 3)
```

### Correlation of Gd
```{r}
# Gd & Ho
p26 <- res_cor_cop %>%
  ggplot(aes(x = Gd, y = Ho)) +
  geom_point() +
  geom_smooth(method = "lm")

# Gd & Nd
p27 <- res_cor_cop %>%
  ggplot(aes(x = Gd, y = Nd)) +
  geom_point() +
  geom_smooth(method = "lm")

# Gd & Pr
p28 <- res_cor_cop %>%
  ggplot(aes(x = Gd, y = Pr)) +
  geom_point() +
  geom_smooth(method = "lm")

# Gd & Sm
p29 <- res_cor_cop %>%
  ggplot(aes(x = Gd, y = Sm)) +
  geom_point() +
  geom_smooth(method = "lm")

# Gd & Tb
p30 <- res_cor_cop %>%
  ggplot(aes(x = Gd, y = Tb)) +
  geom_point() +
  geom_smooth(method = "lm")

# Gd & Yb
p31 <- res_cor_cop %>%
  ggplot(aes(x = Gd, y = Yb)) +
  geom_point() +
  geom_smooth(method = "lm")

# Gd & Zr
p32 <- res_cor_cop %>%
  ggplot(aes(x = Gd, y = Zr)) +
  geom_point() +
  geom_smooth(method = "lm")

grid.arrange(p26, p27, p28, p29, p30, p31, p32, ncol = 4)
```

### Correlation of Ga
```{r}
# Ga & Nd
p33 <- res_cor_cop %>%
  ggplot(aes(x = Ga, y = Nd)) +
  geom_point() +
  geom_smooth(method = "lm")

# Ga & Pb
p34 <- res_cor_cop %>%
  ggplot(aes(x = Ga, y = Pb)) +
  geom_point() +
  geom_smooth(method = "lm")

# Ga & Pr
p35 <- res_cor_cop %>%
  ggplot(aes(x = Ga, y = Pr)) +
  geom_point() +
  geom_smooth(method = "lm")

# Ga & Rb
p36 <- res_cor_cop %>%
  ggplot(aes(x = Ga, y = Rb)) +
  geom_point() +
  geom_smooth(method = "lm")

# Ga & Sm
p37 <- res_cor_cop %>%
  ggplot(aes(x = Ga, y = Sm)) +
  geom_point() +
  geom_smooth(method = "lm")

# Ga & Th
p38 <- res_cor_cop %>%
  ggplot(aes(x = Ga, y = Th)) +
  geom_point() +
  geom_smooth(method = "lm")

# Ga & Zr
p39 <- res_cor_cop %>%
  ggplot(aes(x = Ga, y = Zr)) +
  geom_point() +
  geom_smooth(method = "lm")

grid.arrange(p33, p34, p35, p36, p37, p38, p39, ncol = 4)
```

### Correlation of Eu
```{r}
# Eu & Ga
p40 <- res_cor_cop %>%
  ggplot(aes(x = Eu, y = Ga)) +
  geom_point() +
  geom_smooth(method = "lm")

# Eu & Ga
p41 <- res_cor_cop %>%
  ggplot(aes(x = Eu, y = Gd)) +
  geom_point() +
  geom_smooth(method = "lm")

# Eu & Ga
p42 <- res_cor_cop %>%
  ggplot(aes(x = Eu, y = Ho)) +
  geom_point() +
  geom_smooth(method = "lm")

# Eu & Ga
p43 <- res_cor_cop %>%
  ggplot(aes(x = Eu, y = Nd)) +
  geom_point() +
  geom_smooth(method = "lm")

# Eu & Ga
p44 <- res_cor_cop %>%
  ggplot(aes(x = Eu, y = Pr)) +
  geom_point() +
  geom_smooth(method = "lm")

# Eu & Ga
p45 <- res_cor_cop %>%
  ggplot(aes(x = Eu, y = Sm)) +
  geom_point() +
  geom_smooth(method = "lm")

# Eu & Ga
p46 <- res_cor_cop %>%
  ggplot(aes(x = Eu, y = Tb)) +
  geom_point() +
  geom_smooth(method = "lm")

# Eu & Ga
p47 <- res_cor_cop %>%
  ggplot(aes(x = Eu, y = Yb)) +
  geom_point() +
  geom_smooth(method = "lm")

# Eu & Ga
p48 <- res_cor_cop %>%
  ggplot(aes(x = Eu, y = Zr)) +
  geom_point() +
  geom_smooth(method = "lm")

grid.arrange(p40, p41, p42, p43, p44, p45, p46, p47, p48, ncol = 3)
```

### Correlation of Er
```{r}
# Er & Ga
p50 <- res_cor_cop %>%
  ggplot(aes(x = Er, y = Eu)) +
  geom_point() +
  geom_smooth(method = "lm")

# Er & Ga
p51 <- res_cor_cop %>%
  ggplot(aes(x = Er, y = Gd)) +
  geom_point() +
  geom_smooth(method = "lm")

# Er & Ga
p52 <- res_cor_cop %>%
  ggplot(aes(x = Er, y = Ho)) +
  geom_point() +
  geom_smooth(method = "lm")

# Er & Ga
p53 <- res_cor_cop %>%
  ggplot(aes(x = Er, y = Nd)) +
  geom_point() +
  geom_smooth(method = "lm")

# Er & Ga
p54 <- res_cor_cop %>%
  ggplot(aes(x = Er, y = Pr)) +
  geom_point() +
  geom_smooth(method = "lm")

# Er & Ga
p55 <- res_cor_cop %>%
  ggplot(aes(x = Er, y = Sm)) +
  geom_point() +
  geom_smooth(method = "lm")

# Er & Ga
p56 <- res_cor_cop %>%
  ggplot(aes(x = Er, y = Tb)) +
  geom_point() +
  geom_smooth(method = "lm")

# Er & Ga
p57 <- res_cor_cop %>%
  ggplot(aes(x = Er, y = Yb)) +
  geom_point() +
  geom_smooth(method = "lm")

# Er & Zr
p58 <- res_cor_cop %>%
  ggplot(aes(x = Er, y = Zr)) +
  geom_point() +
  geom_smooth(method = "lm")

grid.arrange(p50, p51, p52, p53, p54, p55, p56, p57, p58, ncol = 3)
```

### Correlation of Dy
```{r}
# Dy & Er
p60 <- res_cor_cop %>%
  ggplot(aes(x = Dy, y = Er)) +
  geom_point() +
  geom_smooth(method = "lm")

# Dy & Eu
p61 <- res_cor_cop %>%
  ggplot(aes(x = Dy, y = Eu)) +
  geom_point() +
  geom_smooth(method = "lm")

# Dy & Gd
p62 <- res_cor_cop %>%
  ggplot(aes(x = Dy, y = Gd)) +
  geom_point() +
  geom_smooth(method = "lm")

# Dy & Ho
p63 <- res_cor_cop %>%
  ggplot(aes(x = Dy, y = Ho)) +
  geom_point() +
  geom_smooth(method = "lm")

# Dy & Nd
p64 <- res_cor_cop %>%
  ggplot(aes(x = Dy, y = Nd)) +
  geom_point() +
  geom_smooth(method = "lm")

# Dy & Pr
p65 <- res_cor_cop %>%
  ggplot(aes(x = Dy, y = Pr)) +
  geom_point() +
  geom_smooth(method = "lm")

# Dy & Sm
p66 <- res_cor_cop %>%
  ggplot(aes(x = Dy, y = Sm)) +
  geom_point() +
  geom_smooth(method = "lm")

# Dy & Tb
p67 <- res_cor_cop %>%
  ggplot(aes(x = Dy, y = Tb)) +
  geom_point() +
  geom_smooth(method = "lm")

# Dy & Yb
p68 <- res_cor_cop %>%
  ggplot(aes(x = Dy, y = Yb)) +
  geom_point() +
  geom_smooth(method = "lm")

# Dy & Zr
p69 <- res_cor_cop %>%
  ggplot(aes(x = Dy, y = Zr)) +
  geom_point() +
  geom_smooth(method = "lm")

grid.arrange(p60, p61, p62, p63, p64, p65, p66, p67, p68, p69, ncol = 5)
```

### Correlation of Ce
```{r}
# Ce & Dy
p70 <- res_cor_cop %>%
  ggplot(aes(x = Ce, y = Dy)) +
  geom_point() +
  geom_smooth(method = "lm")

# Ce & Er
p71 <- res_cor_cop %>%
  ggplot(aes(x = Ce, y = Er)) +
  geom_point() +
  geom_smooth(method = "lm")

# Ce & Eu
p72 <- res_cor_cop %>%
  ggplot(aes(x = Ce, y = Eu)) +
  geom_point() +
  geom_smooth(method = "lm")

# Ce & Ga
p73 <- res_cor_cop %>%
  ggplot(aes(x = Ce, y = Ga)) +
  geom_point() +
  geom_smooth(method = "lm")

# Ce & Gd
p74 <- res_cor_cop %>%
  ggplot(aes(x = Ce, y = Gd)) +
  geom_point() +
  geom_smooth(method = "lm")

# Ce & Ho
p75 <- res_cor_cop %>%
  ggplot(aes(x = Ce, y = Ho)) +
  geom_point() +
  geom_smooth(method = "lm")

# Ce & Nd
p76 <- res_cor_cop %>%
  ggplot(aes(x = Ce, y = Nd)) +
  geom_point() +
  geom_smooth(method = "lm")

# Ce & Pb
p77 <- res_cor_cop %>%
  ggplot(aes(x = Ce, y = Pb)) +
  geom_point() +
  geom_smooth(method = "lm")

# Ce & Pr
p78 <- res_cor_cop %>%
  ggplot(aes(x = Ce, y = Pr)) +
  geom_point() +
  geom_smooth(method = "lm")

# Ce & Sm
p79 <- res_cor_cop %>%
  ggplot(aes(x = Ce, y = Sm)) +
  geom_point() +
  geom_smooth(method = "lm")

# Ce & Tb
p80 <- res_cor_cop %>%
  ggplot(aes(x = Ce, y = Tb)) +
  geom_point() +
  geom_smooth(method = "lm")

# Ce & Th
p81 <- res_cor_cop %>%
  ggplot(aes(x = Ce, y = Th)) +
  geom_point() +
  geom_smooth(method = "lm")

# Ce & Yb
p82 <- res_cor_cop %>%
  ggplot(aes(x = Ce, y = Yb)) +
  geom_point() +
  geom_smooth(method = "lm")

# Ce & Zr
p83 <- res_cor_cop %>%
  ggplot(aes(x = Ce, y = Zr)) +
  geom_point() +
  geom_smooth(method = "lm")

# Ce & LREE
p84 <- res_cor_cop %>%
  ggplot(aes(x = Ce, y = LREE)) +
  geom_point() +
  geom_smooth(method = "lm")

grid.arrange(p70, p71, p72, p73, p74, p75, p76, p77, p78, p79, p80, p81, p82, p83, p84, ncol = 5)
```

